   1               		.file	"spi.c"
   2               	__SP_L__ = 0x3d
   3               	__SREG__ = 0x3f
   4               	__tmp_reg__ = 0
   5               	__zero_reg__ = 1
   6               		.text
   7               	.Ltext0:
   8               		.cfi_sections	.debug_frame
   9               	.global	spiXfer
  11               	spiXfer:
  12               	.LFB0:
  13               		.file 1 "spi.c"
   1:spi.c         **** /******************************************************************************
   2:spi.c         **** Created 26 Nov 2012 by Mike Hord at SparkFun Electronics.
   3:spi.c         **** Wake-on-Shake hardware and firmware are released under the Creative Commons 
   4:spi.c         **** Share Alike v3.0 license:
   5:spi.c         **** 	http://creativecommons.org/licenses/by-sa/3.0/
   6:spi.c         **** Feel free to use, distribute, and sell variants of Wake-on-Shake. All we ask 
   7:spi.c         **** is that you include attribution of 'Based on Wake-on-Shake by SparkFun'.
   8:spi.c         **** 
   9:spi.c         **** spi.cpp
  10:spi.c         **** Functional support for the SPI. This doesn't seem to be well supported in the
  11:spi.c         **** AVR libraries, but maybe I didn't look in the right places.
  12:spi.c         **** ******************************************************************************/
  13:spi.c         **** 
  14:spi.c         **** #include <avr/io.h>
  15:spi.c         **** #include "spi.h"
  16:spi.c         **** 
  17:spi.c         **** // spiXfer() takes a byte and sends it out via the USI function. It does
  18:spi.c         **** //   NOT handle the chip select; user must do that before calling spiXfer().
  19:spi.c         **** //   It returns the value that was shifted in. Please review the datasheet
  20:spi.c         **** //   for an explanation of the hows and whys- it's important to note that
  21:spi.c         **** //   unlike more advanced processors, the Tinty2313a does not support a
  22:spi.c         **** //   hands-off shift method. The data must be clocked out under software
  23:spi.c         **** //   control!
  24:spi.c         **** uint8_t spiXfer(uint8_t data)
  25:spi.c         **** {
  14               		.loc 1 25 0
  15               		.cfi_startproc
  16               	.LVL0:
  17               	/* prologue: function */
  18               	/* frame size = 0 */
  19               	/* stack size = 0 */
  20               	.L__stack_usage = 0
  26:spi.c         **** 	USIDR = data;
  21               		.loc 1 26 0
  22 0000 8FB9      		out 0xf,r24
  27:spi.c         **** 	while ((USISR & (1<<USIOIF)) == 0)
  28:spi.c         **** 	{
  29:spi.c         **** 		USICR = (0<<USIWM1) | (1<<USIWM0) | (1<<USICS1) | (0<<USICS0) | (1<<USICLK) | (1<<USITC);
  23               		.loc 1 29 0
  24 0002 8BE1      		ldi r24,lo8(27)
  25               	.LVL1:
  26               	.L2:
  27:spi.c         **** 	while ((USISR & (1<<USIOIF)) == 0)
  27               		.loc 1 27 0 discriminator 1
  28 0004 7699      		sbic 0xe,6
  29 0006 00C0      		rjmp .L5
  30               		.loc 1 29 0
  31 0008 8DB9      		out 0xd,r24
  32 000a 00C0      		rjmp .L2
  33               	.L5:
  30:spi.c         **** 	}
  31:spi.c         **** 	USISR = (1<<USIOIF);
  34               		.loc 1 31 0
  35 000c 80E4      		ldi r24,lo8(64)
  36 000e 8EB9      		out 0xe,r24
  32:spi.c         **** 	return USIDR;
  37               		.loc 1 32 0
  38 0010 8FB1      		in r24,0xf
  33:spi.c         **** }...
  39               		.loc 1 33 0
  40 0012 0895      		ret
  41               		.cfi_endproc
  42               	.LFE0:
  44               	.Letext0:
  45               		.file 2 "/usr/local/CrossPack-AVR-20131216/avr/include/stdint.h"
DEFINED SYMBOLS
                            *ABS*:00000000 spi.c
/var/folders/jy/pkqnkk1s5x97h68j2fkh30vh0000gq/T//ccfg7wsG.s:2      *ABS*:0000003d __SP_L__
/var/folders/jy/pkqnkk1s5x97h68j2fkh30vh0000gq/T//ccfg7wsG.s:3      *ABS*:0000003f __SREG__
/var/folders/jy/pkqnkk1s5x97h68j2fkh30vh0000gq/T//ccfg7wsG.s:4      *ABS*:00000000 __tmp_reg__
/var/folders/jy/pkqnkk1s5x97h68j2fkh30vh0000gq/T//ccfg7wsG.s:5      *ABS*:00000001 __zero_reg__
/var/folders/jy/pkqnkk1s5x97h68j2fkh30vh0000gq/T//ccfg7wsG.s:11     .text:00000000 spiXfer

NO UNDEFINED SYMBOLS
